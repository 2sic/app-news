@inherits ToSic.Sxc.Dnn.RazorComponent
@using ToSic.Razor.Blade;
@*
  Case #1: Bootstrap 3 - read the readme.md section "CSS Framework Detection"
*@
@if(Connect.Koi.Koi.Is("bs3")) {
  @RenderPage("bs3/_Details.cshtml")
  return;
}
@*
  Case #2: Bootstrap 4 or Unknown CSS Framework
*@
@RenderPage("shared/_Assets.cshtml", new { scripts = true} )

@{
  var parts = CreateInstance("shared/_Parts.cshtml");

  var article = AsList(Data).FirstOrDefault();
}

@* Show article not found notification and stop processing *@
@if(article == null) {
  @* Displays article not found info *@
  <h1>@App.Resources.LabelEventNotExists</h1>
  <p>@App.Resources.LabelEventNotExistsText</p>

  @* Show "Back to list" button *@
  @BackToListButton()
  return;
}

@{
  @* Add Meta tag and adjust page title *@
  HtmlPage.AddMeta("description", Tags.Strip(article.Teaser));
  HtmlPage.Title = article.Date.ToString("d") + " - " + article.Title +  " | " + HtmlPage.Title;
}

<div class="app-news app-news-detail" @Edit.TagToolbar(article)>
  @* Head of the article *@
  <div class="app-content">
    @* "Will publish"/"expired" notes for admin *@
    @parts.ArticleInformationAdmin(article)

    <h2>@article.Title</h2>

    @* Show Date and categories *@
    @parts.ArticleInformationDateAndCategories(article)
  </div>

  @* Body of the article *@
  <div class="app-content">
    @* Show image or placeholder *@
    @parts.ImageOrPlaceholder(article, true)

    @if(article.ShowTeaserInDetail) {
      <p class="app-news-detail-teaser">@Html.Raw(Tags.Nl2Br(article.Teaser))</p>
    }

    <div class="app-news-detail-body">@Html.Raw(article.Body)</div>
  </div>
</div>

@* Show "Back to list" button *@
@BackToListButton()

@* Shows a back to list button *@
@helper BackToListButton() {
  var categoryInUrl = Request.QueryString["category"];
  var categoryParams = Text.Has(categoryInUrl)
      ? "category=" + categoryInUrl
      : "";

  @Tag.A().Class("btn btn-outline-primary app-backtolist").Href(Link.To(parameters: categoryParams)).Wrap(App.Resources.LabelBackToList)
}